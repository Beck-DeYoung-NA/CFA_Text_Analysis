for (code in top_acodes$acode){
mydata[, glue("bcode{code}")] <- select(mydata, starts_with("acode")) == code %>% rowSums(na.rm = T)
}
library(tidyverse)
library(glue)
NUM_CODES <- 13
Q_NUM <- 5
DATE <- "073022" # MMDDYY
# This csv file has stacked all of the 3 Q5 questions
mydata <- "NAXION_CFA_OrgDrag_codingexamples_{DATE}_Q{Q_NUM}.csv" %>% glue() %>%
read.csv(fileEncoding="latin1") %>%
rename("Body" = 2) # Rename second column to Body
# actual codes in single list
all_acodes <- mydata %>%
select(starts_with('acode')) %>% as.matrix() %>% as.vector()
# Get top codes by number of responses
top_acodes <- data.frame(acode = all_acodes) %>%
na.omit() %>% # Drop missing values
group_by(acode) %>% summarise(n = n()) %>% arrange(desc(n)) %>% # Get counts and order by most instances
filter(!acode %in% c(98, 99)) %>% # Remove codes 98 and 99
filter(row_number() <= NUM_CODES) # Only keep the top 13
mydata <- mydata %>%
mutate(Id = row_number()) %>%
filter(acode1<98)
for (code in top_acodes$acode){
mydata[, glue("bcode{code}")] <- select(mydata, starts_with("acode")) == code %>% rowSums(na.rm = T)
}
for (code in top_acodes$acode){
mydata[, glue("bcode{code}")] <- (select(mydata, starts_with("acode")) == code) %>% rowSums(na.rm = T)
}
for (code in top_acodes$acode){
mydata[, glue("bcode{code}")] <- rowSums(select(mydata, starts_with("acode")) == code, na.rm = T)
}
# Make longer dataset
longdata <- mydata %>% pivot_longer(cols = starts_with("bcode"),
names_to = "bcode",
values_to = "code_present") %>%
filter(code_present == 1) %>% # code_present is 1 if the code is detected and 0 if not
mutate(Tag = str_extract(bcode, "[0-9]{1,}") %>% as.numeric()) %>%
select(Id, Body, Tag)
justtags <-longdata %>% select(Id, Tag)
justtext <- mydata %>% select(Id, Body) %>%
filter(Id %in% longdata$Id)
library(tidyverse)
library(glue)
NUM_CODES <- 13
Q_NUM <- 5
DATE <- "073022" # MMDDYY
# This csv file has stacked all of the 3 Q5 questions
mydata <- "NAXION_CFA_OrgDrag_codingexamples_{DATE}_Q{Q_NUM}.csv" %>% glue() %>%
read.csv(fileEncoding="latin1") %>%
rename("Body" = 2) # Rename second column to Body
# actual codes in single list
all_acodes <- mydata %>%
select(starts_with('acode')) %>% as.matrix() %>% as.vector()
# Get top codes by number of responses
top_acodes <- data.frame(acode = all_acodes) %>%
na.omit() %>% # Drop missing values
group_by(acode) %>% summarise(n = n()) %>% arrange(desc(n)) %>% # Get counts and order by most instances
filter(!acode %in% c(98, 99)) %>% # Remove codes 98 and 99
filter(row_number() <= NUM_CODES) # Only keep the top 13
#Note one respondent can give more than one open-end in Q5 so NA ID's are duplicated
#Let's create unique IDs
mydata <- mydata %>%
mutate(Id = row_number()) %>%
filter(acode1<98)
mydata %>% write_csv("NAXION_Q{Q_NUM}_True_Scores_all_data_for_scoring.csv" %>% glue())
for (code in top_acodes$acode){
mydata[, glue("bcode{code}")] <- rowSums(select(mydata, starts_with("acode")) == code, na.rm = T)
}
mydata %>% write_csv("NAXION_Q5_True_Scores_all_top13codes.csv")
# Make longer data set
longdata <- mydata %>% pivot_longer(cols = starts_with("bcode"),
names_to = "bcode",
values_to = "code_present") %>%
filter(code_present == 1) %>% # code_present is 1 if the code is detected and 0 if not
mutate(Tag = str_extract(bcode, "[0-9]{1,}") %>% as.numeric()) %>%
select(Id, Body, Tag)
longdata %>% write_csv(file="NAXION_Q{Q_NUM}_long_top{NUM_CODES}codes.csv" %>% glue())
justtags <-longdata %>% select(Id, Tag)
justtags %>% write_csv("NAXION_Q{Q_NUM}_top{NUM_CODES}tags_for_BERT.csv" %>% glue())
justtext <- mydata %>% select(Id, Body) %>%
filter(Id %in% longdata$Id)
justtext %>% write_csv("NAXION_Q{Q_NUM}_top{NUM_CODES}text_for_BERT.csv" %>% glue())
View(justtags)
View(justtext)
library(tidyverse)
library(glue)
NUM_CODES <- 13
Q_NUM <- 5
DATE <- "073022" # MMDDYY
# This csv file has stacked all of the 3 Q5 questions
mydata <- "NAXION_CFA_OrgDrag_codingexamples_{DATE}_Q{Q_NUM}.csv" %>% glue() %>%
read.csv(fileEncoding="latin1") %>%
rename("Body" = 2) # Rename second column to Body
# This csv file has stacked all of the 3 Q5 questions
mydata <- "../Data/NAXION_CFA_OrgDrag_codingexamples_{DATE}_Q{Q_NUM}.csv" %>% glue() %>%
read.csv(fileEncoding="latin1") %>%
rename("Body" = 2) # Rename second column to Body
# This csv file has stacked all of the 3 Q5 questions
mydata <- "Data/NAXION_CFA_OrgDrag_codingexamples_{DATE}_Q{Q_NUM}.csv" %>% glue() %>%
read.csv(fileEncoding="latin1") %>%
rename("Body" = 2) # Rename second column to Body
# actual codes in single list
all_acodes <- mydata %>%
select(starts_with('acode')) %>% as.matrix() %>% as.vector()
all_acodes <- mydata %>%
select(starts_with('acode')) %>% as.matrix()
View(all_acodes)
# actual codes in single list
all_acodes <- mydata %>%
select(starts_with('acode')) %>% as.matrix() %>% as.vector()
# Get top codes by number of responses
top_acodes <- data.frame(acode = all_acodes) %>%
na.omit() %>% # Drop missing values
group_by(acode) %>% summarise(n = n()) %>% arrange(desc(n)) %>% # Get counts and order by most instances
filter(!acode %in% c(98, 99)) %>% # Remove codes 98 and 99
filter(row_number() <= NUM_CODES) # Only keep the top 13
top_acodes <- data.frame(acode = all_acodes) %>%
na.omit() %>% # Drop missing values
group_by(acode) %>% summarise(n = n()) %>% arrange(desc(n)) %>% # Get counts and order by most instances
filter(!acode %in% c(98, 99))
View(top_acodes)
